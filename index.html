<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- SEO -->
  <title>ResumeIQ – ATS Resume Builder & JD Matcher</title>
  <meta name="description" content="ResumeIQ helps you optimize your resume for ATS systems." />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 24px;
      max-width: 900px;
      margin: auto;
      background: #fafafa;
    }
    input, textarea, button, select {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .box {
      background: #fff;
      padding: 16px;
      margin-top: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .muted { color:#666; font-size:14px; }
  </style>

  <!-- PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Razorpay -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<h2>ATS Resume Builder</h2>
<p class="muted">Day 10.4 – Secure Payment Verification</p>

<input id="name" placeholder="Name" />
<input id="role" placeholder="Target Role" />
<textarea id="summary" placeholder="Professional Summary"></textarea>
<button id="rewriteBtn" onclick="rewriteSummary()">✨ Rewrite Summary (AI)</button>

<button id="pdfBtn" onclick="downloadPDF()">Download Resume (PDF)</button>

<div class="box">
  <h3>Current Plan</h3>
  <p><b>Plan:</b> <span id="plan"></span></p>
  <p><b>Status:</b> <span id="payStatus"></span></p>
  <p><b>AI Left:</b> <span id="aiLeft"></span></p>
</div>

<div class="box">
  <h3>Upgrade Plan</h3>
  <select id="upgradeSelect">
    <option value="49">₹49 – One Time</option>
    <option value="99">₹99 – Weekly</option>
  </select>
  <button onclick="upgradePlan()">Upgrade</button>
</div>

<script>
/* Razorpay TEST Key */
const RAZORPAY_KEY = "rzp_test_SC2mAeZLsa3z1e";

/* Plans */
const PLANS = {
  49:{name:"One-Time",ai:3},
  99:{name:"Weekly",ai:10}
};

/* Default Plan */
if(!localStorage.getItem("plan")){
  localStorage.setItem("plan", JSON.stringify({
    name:"Free",
    aiLeft:1,
    paymentStatus:"none"
  }));
}

/* Helpers */
function getPlan(){
  return JSON.parse(localStorage.getItem("plan"));
}
function savePlan(p){
  localStorage.setItem("plan", JSON.stringify(p));
}
function render(){
  const p = getPlan();
  plan.textContent = p.name;
  aiLeft.textContent = p.aiLeft;
  payStatus.textContent = p.paymentStatus;

  rewriteBtn.disabled = p.aiLeft <= 0;
  pdfBtn.disabled = p.aiLeft <= 0;
}

/* AI */
function rewriteSummary(){
  const p = getPlan();
  if(p.aiLeft <= 0){
    alert("Upgrade required");
    return;
  }
  summary.value += " (AI optimized)";
  p.aiLeft--;
  savePlan(p);
  render();
}

/* PDF */
function downloadPDF(){
  const p = getPlan();
  if(p.aiLeft <= 0){
    alert("Upgrade required");
    return;
  }
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.text(summary.value || "Resume",10,10);
  pdf.save("resume.pdf");
}

/* MOCK PAYMENT VERIFICATION (replace with backend later) */
function verifyPayment(paymentId){
  console.log("Verifying payment:", paymentId);
  return true; // ✅ simulated success
}

/* Upgrade Flow */
function upgradePlan(){
  const price = upgradeSelect.value;
  const planDef = PLANS[price];

  const options = {
    key: RAZORPAY_KEY,
    amount: price * 100,
    currency: "INR",
    name: "ResumeIQ",
    handler: function(resp){

      // Step 1: mark pending
      const p = getPlan();
      p.paymentStatus = "pending";
      savePlan(p);
      render();

      // Step 2: verify
      const verified = verifyPayment(resp.razorpay_payment_id);

      if(verified){
        p.name = planDef.name;
        p.aiLeft = planDef.ai;
        p.paymentStatus = "verified";
        savePlan(p);
        alert("✅ Payment verified. Plan activated.");
        render();
      } else {
        alert("❌ Payment verification failed");
      }
    }
  };

  new Razorpay(options).open();
}

/* Init */
render();
</script>

</body>
</html>
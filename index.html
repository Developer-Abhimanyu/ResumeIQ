<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- SEO -->
  <title>ResumeIQ ‚Äì ATS Resume Builder & JD Matcher</title>
  <meta name="description" content="ResumeIQ helps you optimize your resume ATS score." />

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 24px;
      max-width: 900px;
      margin: auto;
      background: #fafafa;
    }
    input, textarea, button, select {
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      font-size: 14px;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .box {
      background: #fff;
      padding: 16px;
      margin-top: 24px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .muted { color: #666; font-size: 14px; }

    /* ---------- Day 10.6 : ADMIN PANEL ---------- */
    #adminPanel {
      display: none;
      position: fixed;
      bottom: 16px;
      right: 16px;
      width: 320px;
      background: #0f172a;
      color: #fff;
      padding: 16px;
      border-radius: 12px;
      z-index: 9999;
      font-size: 13px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    #adminPanel h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
    }
    #adminPanel button {
      width: 100%;
      margin-top: 6px;
      padding: 8px;
      background: #334155;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #adminPanel button:hover {
      background: #475569;
    }
  </style>

  <!-- PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Razorpay -->
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<h2>ResumeIQ ATS Resume Builder</h2>
<p class="muted">Improve your resume ATS score and match job descriptions in seconds.</p>

<input id="name" placeholder="Name" />
<input id="role" placeholder="Target Role" />
<textarea id="summary" placeholder="Professional Summary"></textarea>
<button id="rewriteBtn" onclick="rewriteSummary()">‚ú® Rewrite Summary (AI)</button>

<textarea id="jd" placeholder="Job Description"></textarea>
<textarea id="experience" placeholder="Experience"></textarea>
<input id="skills" placeholder="Skills (comma separated)" />

<button onclick="saveResume()">Save Resume</button>
<button id="pdfBtn" onclick="downloadPDF()">Download Resume (PDF)</button>

<!-- PLAN -->
<div class="box">
  <h3>Current Plan</h3>
  <p><b>Plan:</b> <span id="plan"></span></p>
  <p><b>Plan Expiry:</b> <span id="expiry"></span></p>
  <p><b>AI Rewrites Left:</b> <span id="aiLeft"></span></p>
  <p><b>Payment Status:</b> <span id="payStatus"></span></p>
</div>

<!-- UPGRADE -->
<div class="box">
  <h3>Upgrade Plan</h3>
  <select id="upgradeSelect">
    <option value="49">‚Çπ49 ‚Äì One Time</option>
    <option value="99">‚Çπ99 ‚Äì 1 Week</option>
    <option value="149">‚Çπ149 ‚Äì 15 Days</option>
    <option value="299">‚Çπ299 ‚Äì 1 Month</option>
    <option value="699">‚Çπ699 ‚Äì 3 Months</option>
    <option value="999">‚Çπ999 ‚Äì 6 Months</option>
    <option value="1699">‚Çπ1699 ‚Äì 1 Year</option>
  </select>
  <button onclick="upgradePlan()">Upgrade</button>
</div>

<div class="box muted">
  ResumeIQ v1.0 ‚Ä¢ Last updated: <span id="buildDate"></span>
</div>

<!-- ---------- Day 10.6 : ADMIN PANEL ---------- -->
<div id="adminPanel">
  <h4>üîê Admin Panel</h4>
  <div id="adminStats"></div>
  <button onclick="resetAnalytics()">Reset Analytics</button>
  <button onclick="resetPlan()">Reset Plan</button>
  <button onclick="exportAnalytics()">Export Analytics</button>
</div>

<script>
document.getElementById("buildDate").textContent = new Date().toLocaleDateString();

/* ---------------- Day 10.5 : ANALYTICS ---------------- */
const analytics = JSON.parse(localStorage.getItem("analytics")) || {
  visits: 0,
  aiRewrites: 0,
  pdfDownloads: 0,
  saves: 0,
  upgrades: 0,
  lastAction: null
};

function track(action){
  analytics[action] = (analytics[action] || 0) + 1;
  analytics.lastAction = new Date().toISOString();
  localStorage.setItem("analytics", JSON.stringify(analytics));
  console.log("[Analytics]", action);
}

analytics.visits++;
localStorage.setItem("analytics", JSON.stringify(analytics));

/* ---------------- Day 10.5 : RATE LIMITER ---------------- */
const limits = { ai: [], pdf: [] };

function allow(action, max, perMs){
  const now = Date.now();
  limits[action] = limits[action].filter(t => now - t < perMs);
  if(limits[action].length >= max) return false;
  limits[action].push(now);
  return true;
}

/* Razorpay TEST Key */
const RAZORPAY_KEY = "rzp_test_SC2mAeZLsa3z1e";

/* PLANS */
const PLANS = {
  49:{name:"One-Time",days:1,ai:3},
  99:{name:"Weekly",days:7,ai:10},
  149:{name:"15 Days",days:15,ai:25},
  299:{name:"Monthly",days:30,ai:50},
  699:{name:"3 Months",days:90,ai:120},
  999:{name:"6 Months",days:180,ai:250},
  1699:{name:"Yearly",days:365,ai:999}
};

/* DEFAULT PLAN */
if(!localStorage.getItem("plan")){
  localStorage.setItem("plan",JSON.stringify({
    price:49,
    name:"One-Time",
    expiry:null,
    aiLeft:3,
    paymentStatus:"none",
    paymentId:null
  }));
}

/* HELPERS */
function getPlan(){ return JSON.parse(localStorage.getItem("plan")); }
function savePlan(p){ localStorage.setItem("plan",JSON.stringify(p)); }

function renderPlan(){
  const p = getPlan();
  plan.textContent = `‚Çπ${p.price} (${p.name})`;
  expiry.textContent = p.expiry
    ? new Date(p.expiry).toLocaleDateString()
    : "One-time";
  aiLeft.textContent = p.aiLeft;
  payStatus.textContent = p.paymentStatus;
  rewriteBtn.disabled = p.aiLeft <= 0;
  pdfBtn.disabled = p.aiLeft <= 0;
}

/* AI REWRITE */
function rewriteSummary(){
  if(!allow("ai",5,60000)){
    alert("‚ö†Ô∏è Too many AI requests. Please slow down.");
    return;
  }

  const p = getPlan();
  if(p.aiLeft <= 0){
    alert("‚ö†Ô∏è AI limit reached. Please upgrade.");
    return;
  }

  summary.value = summary.value
    ? summary.value + " (AI optimized)"
    : "AI optimized professional summary.";

  p.aiLeft--;
  savePlan(p);
  track("aiRewrites");
  renderPlan();
}

/* PDF */
function downloadPDF(){
  if(!allow("pdf",3,60000)){
    alert("‚ö†Ô∏è Too many downloads. Please wait.");
    return;
  }

  const p = getPlan();
  if(p.aiLeft <= 0){
    alert("‚ö†Ô∏è Upgrade required.");
    return;
  }

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();
  pdf.text(`Name: ${name.value}`,10,10);
  pdf.text(`Role: ${role.value}`,10,20);
  pdf.text(`Summary: ${summary.value}`,10,30);
  pdf.save("resume.pdf");

  track("pdfDownloads");
}

/* SAVE */
function saveResume(){
  track("saves");
  alert("Resume saved locally (demo).");
}

/* MOCK VERIFICATION */
function verifyPayment(paymentId){
  console.log("Verifying payment:", paymentId);
  return true;
}

/* RAZORPAY */
function upgradePlan(){
  const price = upgradeSelect.value;
  const planDef = PLANS[price];
  if(!planDef) return alert("Invalid plan");

  const options = {
    key: RAZORPAY_KEY,
    amount: price * 100,
    currency: "INR",
    name: "ResumeIQ",
    description: `${planDef.name} Plan`,
    handler: function(resp){
      track("upgrades");

      const p = getPlan();
      p.paymentStatus = "pending";
      p.paymentId = resp.razorpay_payment_id;
      savePlan(p);
      renderPlan();

      const verified = verifyPayment(resp.razorpay_payment_id);
      if(verified){
        p.price = price;
        p.name = planDef.name;
        p.expiry = Date.now() + planDef.days * 86400000;
        p.aiLeft = planDef.ai;
        p.paymentStatus = "verified";
        savePlan(p);
        alert("‚úÖ Payment verified. Plan activated.");
        renderPlan();
      } else {
        alert("‚ùå Payment verification failed.");
      }
    }
  };

  new Razorpay(options).open();
}

/* ---------- Day 10.6 : ADMIN PANEL LOGIC ---------- */
document.addEventListener("keydown", function(e){
  if((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === "D"){
    const panel = document.getElementById("adminPanel");
    panel.style.display = panel.style.display === "none" ? "block" : "none";
    renderAdmin();
  }
});

function renderAdmin(){
  document.getElementById("adminStats").innerHTML = `
    Visits: ${analytics.visits}<br>
    AI Rewrites: ${analytics.aiRewrites}<br>
    PDF Downloads: ${analytics.pdfDownloads}<br>
    Saves: ${analytics.saves}<br>
    Upgrades: ${analytics.upgrades}<br>
    Last Action: ${analytics.lastAction || "-"}
  `;
}

function resetAnalytics(){
  localStorage.removeItem("analytics");
  alert("Analytics reset");
  location.reload();
}

function resetPlan(){
  localStorage.removeItem("plan");
  alert("Plan reset");
  location.reload();
}

function exportAnalytics(){
  alert(JSON.stringify(analytics, null, 2));
}

/* INIT */
renderPlan();
</script>

</body>
</html>